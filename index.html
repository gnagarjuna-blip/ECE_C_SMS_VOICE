<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECE Attendance Pro - G. Nagarjuna</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; padding-bottom: 340px; font-family: 'Segoe UI', sans-serif; }
        .header { background: #1a237e; color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; border-bottom: 4px solid #ffd600; }
        .student-item { background: white; margin: 8px; padding: 12px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; border-left: 8px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .is-a { border-left-color: #d32f2f; background: #fff5f5; }
        .is-p { border-left-color: #2e7d32; background: #f1f8f1; }
        .footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid #ddd; z-index: 1001; border-radius: 20px 20px 0 0; }
        .action-btns { display: flex; gap: 8px; }
        .btn-round { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 16px; color: white; font-weight: bold; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .bg-wa { background: #25d366; }
        .bg-call { background: #0d6efd; }
        #history-view { display:none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; padding:20px; }
        .history-card { background: white; height: 85%; border-radius: 15px; padding: 20px; overflow-y: auto; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 11px; white-space: pre-wrap; color: #333; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div id="history-view">
    <div class="history-card shadow">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0 fw-bold text-primary">üìú SAVED HISTORY</h5>
            <button class="btn-close" onclick="closeHistory()"></button>
        </div>
        <div id="history-list"></div>
        <button class="btn btn-outline-danger btn-sm w-100 mt-3" onclick="clearHistory()">DELETE ALL</button>
    </div>
</div>

<div class="header text-center">
    <h5 class="m-0 fw-bold">G. NAGARJUNA (ECE)</h5>
    <div class="d-flex justify-content-between align-items-center mt-2">
        <small id="current-date" class="opacity-75"></small>
        <div class="text-end">
            <div id="perc-ui" style="font-size: 1.4rem; font-weight: 800; color: #ffd600; line-height: 1;">0%</div>
            <div id="count-ui" style="font-size: 0.7rem; font-weight: bold;">(0/0)</div>
        </div>
    </div>
    
    <div class="mt-3 row g-2">
        <div class="col-4">
            <select id="sec-sel" class="form-select form-select-sm" onchange="loadList()">
                <option value="A">Sec A</option>
                <option value="B">Sec B</option>
            </select>
        </div>
        <div class="col-4">
            <select id="period-sel" class="form-select form-select-sm">
                <option value="P1">P1</option><option value="P2">P2</option><option value="P3">P3</option>
                <option value="P4">P4</option><option value="P5">P5</option><option value="P6">P6</option><option value="P7">P7</option>
            </select>
        </div>
        <div class="col-4">
            <div class="btn-group w-100">
                <input type="radio" class="btn-check" name="m" id="p" value="P" checked>
                <label class="btn btn-outline-light btn-sm fw-bold" for="p">P</label>
                <input type="radio" class="btn-check" name="m" id="a" value="A">
                <label class="btn btn-outline-light btn-sm fw-bold" for="a">A</label>
            </div>
        </div>
    </div>
</div>

<div class="container mt-2" id="list"></div>

<div class="footer shadow-lg">
    <div class="d-flex gap-2 mb-2">
        <button class="btn btn-primary flex-grow-1 fw-bold btn-sm" onclick="saveRecord()">üíæ SAVE DATA</button>
        <button class="btn btn-info text-white flex-grow-1 fw-bold btn-sm" onclick="openHistory()">üëÅÔ∏è VIEW SAVED</button>
    </div>
    
    <div class="mb-2">
        <textarea id="custom-msg" class="form-control form-control-sm" rows="2" style="font-size: 11px; background: #fffde7;">
			ATTENDENCE ALERT :RESPECTED  ‡∞™‡±á‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç,

        ‡∞à ‡∞∞‡±ã‡∞ú‡±Å ‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞∞‡±ç‡∞°‡±ç ‡∞ï‡∞æ‡∞≤‡±á‡∞ú‡±ç ‡∞≤‡±ã ‡∞π‡∞æ‡∞ú‡∞∞‡±Å ‡∞ï‡∞æ‡∞≤‡±á‡∞¶‡∞®‡∞ø ‡∞§‡±Ü‡∞≤‡∞ø‡∞Ø‡∞ú‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Æ‡±Å.YOUR WARD IS ABSENT TODAY
			 
          BHARATH INSTITUTE OF EGINEERING TECHNOLOGY ,
		  
		  CLASS INCHARGE G.NAGARJUNA.
Please Call to me to know study details ofyour  ward:</textarea>
    </div>

    <div class="row g-1">
        <div class="col-12"><button class="btn btn-success w-100 fw-bold" onclick="shareGroupWA()">üöÄ SEND GROUP WHATSAPP</button></div>
        <div class="col-6"><button class="btn btn-outline-danger w-100 fw-bold btn-sm" onclick="sendBulkSMS()">üé§ BULK SMS</button></div>
        <div class="col-6"><button class="btn btn-outline-dark w-100 fw-bold btn-sm" onclick="copyText()">üìã COPY REPORT</button></div>
    </div>
</div>

<script>
    const students = {
        "A": [
            {r: "24E11A04D9", n: "K.bharath", p: "919059144275"},
            {r: "24E11A0402", n: "P.Kumar", p: "919177937305"}
        ],
        "B": []
    };

    let att = {};

    function loadList() {
        const sec = document.getElementById('sec-sel').value;
        const container = document.getElementById('list');
        container.innerHTML = '';
        att = {};
        students[sec].forEach(s => {
            att[s.r] = 'P';
            const div = document.createElement('div');
            div.className = 'student-item is-p';
            div.id = `card-${s.r}`;
            div.innerHTML = `
                <div onclick="toggleAtt('${s.r}')" style="flex-grow:1;">
                    <strong class="d-block">${s.r}</strong>
                    <small class="text-muted fw-bold">${s.n.toUpperCase()}</small>
                </div>
                <div class="action-btns">
                    <button onclick="sendWA('${s.p}', '${s.n}')" class="btn-round bg-wa">WA</button>
                    <a href="tel:${s.p}" class="btn-round bg-call">üìû</a>
                </div>
            `;
            container.appendChild(div);
        });
        updateStats();
    }

    function toggleAtt(roll) {
        const mode = document.querySelector('input[name="m"]:checked').value;
        att[roll] = mode;
        document.getElementById(`card-${roll}`).className = 'student-item ' + (mode === 'P' ? 'is-p' : 'is-a');
        updateStats();
    }

    function updateStats() {
        const sec = document.getElementById('sec-sel').value;
        const total = students[sec].length;
        const present = Object.values(att).filter(v => v === 'P').length;
        document.getElementById('perc-ui').innerText = total ? Math.round((present/total)*100) + '%' : '0%';
        document.getElementById('count-ui').innerText = `(${present}/${total})`;
    }

    // Individual Styled WhatsApp Message
    function sendWA(phone, name) {
        const baseMsg = document.getElementById('custom-msg').value;
        const voiceLink = "https://docs.google.com/uc?export=open&id=14v_P3JXTcVrhk6fSwhkdOfF73dSIKvyc";
        
        // Designing the "Colorful" Message
        const styledMsg = `üü¢ *BHARATH COLLEGE(BIET)/ECE ATTENDANCE ALERT* üü¢\n\n` +
                          `üë§ *Student Name:* ${name.toUpperCase()}\n` +
                          `üìù *Status:* _ABSENT_\n\n` +
                          `${baseMsg}\n\n` +
                          `‚ñ∂Ô∏è *LISTEN HERE:* \n\n` +
                          `üôè *Regards,* \n*G. Nagarjuna (ECE Dept)*`;

        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(styledMsg)}`, '_blank');
    }

    function formatAbsentees(absList) {
        if (absList.length === 0) return "All present.";
        let reportStr = ""; let lastPrefix = "";
        absList.forEach((s, index) => {
            const fullRoll = s.r;
            const prefix = fullRoll.substring(0, fullRoll.length - 2);
            const suffix = fullRoll.substring(fullRoll.length - 2);
            if (prefix !== lastPrefix) {
                reportStr += (index === 0 ? "" : "\n") + fullRoll;
                lastPrefix = prefix;
            } else { reportStr += ", " + suffix; }
        });
        return reportStr;
    }

    function generateReport() {
        const sec = document.getElementById('sec-sel').value;
        const period = document.getElementById('period-sel').value;
        const abs = students[sec].filter(s => att[s.r] === 'A');
        return `üìä *ATTENDANCE REPORT*\nüìù *Subject:* ECA\nüë®‚Äçüè´ *Faculty:* G.Nagarjuna\nüìå *Sec:* ${sec} (${period})\nüìÖ *Date:* ${new Date().toLocaleDateString()}\nüìà *Att:* ${document.getElementById('perc-ui').innerText}\n\nüö´ *ABSENTEES:*\n${formatAbsentees(abs)}`;
    }

    function saveRecord() {
        const report = generateReport();
        const records = JSON.parse(localStorage.getItem('ece_v5_hist') || '[]');
        records.unshift({ time: new Date().toLocaleString(), data: report });
        localStorage.setItem('ece_v5_hist', JSON.stringify(records.slice(0, 50)));
        alert("Report Saved!");
    }

    function openHistory() {
        const records = JSON.parse(localStorage.getItem('ece_v5_hist') || '[]');
        const list = document.getElementById('history-list');
        list.innerHTML = records.length ? '' : '<p class="text-center">No records.</p>';
        records.forEach(rec => {
            const div = document.createElement('div');
            div.className = 'mb-3 border-bottom pb-2';
            div.innerHTML = `<small class="fw-bold text-primary">${rec.time}</small><pre>${rec.data}</pre>`;
            list.appendChild(div);
        });
        document.getElementById('history-view').style.display = 'block';
    }

    function closeHistory() { document.getElementById('history-view').style.display = 'none'; }
    function clearHistory() { if(confirm("Clear?")) { localStorage.removeItem('ece_v5_hist'); openHistory(); } }
    function shareGroupWA() { window.open(`https://wa.me/?text=${encodeURIComponent(generateReport())}`, '_blank'); }
    function copyText() { navigator.clipboard.writeText(generateReport()); alert("Copied!"); }
    
    function sendBulkSMS() {
        const sec = document.getElementById('sec-sel').value;
        const abs = students[sec].filter(s => att[s.r] === 'A');
        if(!abs.length) return alert("No absentees!");
        const nums = abs.map(s => s.p).join(/iPad|iPhone|iPod/.test(navigator.userAgent) ? ',' : ';');
        window.location.href = `sms:${nums}?body=${encodeURIComponent(document.getElementById('custom-msg').value)}`;
    }

    document.getElementById('current-date').innerText = new Date().toDateString();
    loadList();
</script>
</body>
</html>
