<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECE Attendance Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; padding-bottom: 220px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .header { background: #1a237e; color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; border-bottom: 4px solid #ffd600; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .student-item { background: white; margin: 8px; padding: 12px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; border-left: 8px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .is-a { border-left-color: #d32f2f; background: #fff5f5; }
        .is-p { border-left-color: #2e7d32; background: #f1f8f1; }
        .footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top-left-radius: 20px; border-top-right-radius: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .perc-display { font-size: 1.6rem; font-weight: 800; color: #ffd600; line-height: 1; }
        .stats-label { font-size: 0.7rem; letter-spacing: 1px; font-weight: bold; }
        .btn-action { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; }
    </style>
</head>
<body>

<div class="header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h5 class="m-0 fw-bold">G. NAGARJUNA (ECE)</h5>
            <small id="date-time" class="opacity-75"></small>
        </div>
        <div class="text-end">
            <div id="perc-ui" class="perc-display">0%</div>
            <div class="stats-label">PRESENT</div>
        </div>
    </div>
    
    <div class="mt-3 row g-2">
        <div class="col-5">
            <select id="sec-sel" class="form-select form-select-sm shadow-sm" onchange="loadList()">
                <option value="A">Section A</option>
                <option value="B">Section B</option>
            </select>
        </div>
        <div class="col-7">
            <div class="btn-group w-100 shadow-sm">
                <input type="radio" class="btn-check" name="m" id="p" value="P" checked>
                <label class="btn btn-outline-light btn-sm fw-bold" for="p">MARK P</label>
                <input type="radio" class="btn-check" name="m" id="a" value="A">
                <label class="btn btn-outline-light btn-sm fw-bold" for="a">MARK A</label>
            </div>
        </div>
    </div>
</div>

<div class="container mt-2" id="list"></div>

<div class="footer">
    <div class="mb-3">
        <textarea id="custom-msg" class="form-control form-control-sm" rows="2" placeholder="SMS Message Content...">ECE Alert: Your child is ABSENT today. Voice link: https://voca.ro/example123</textarea>
    </div>
    <div class="row g-2">
        <div class="col-12">
            <button class="btn btn-success w-100 fw-bold py-2 shadow-sm" onclick="shareGroupReport()">
                ðŸš€ SEND GROUP REPORT TO WHATSAPP
            </button>
        </div>
        <div class="col-6">
            <button class="btn btn-outline-danger w-100 fw-bold btn-sm" onclick="sendVoiceSMS()">ðŸŽ¤ BULK SMS</button>
        </div>
        <div class="col-6">
            <button class="btn btn-outline-dark w-100 fw-bold btn-sm" onclick="copyToClipboard()">ðŸ“‹ COPY TEXT</button>
        </div>
    </div>
</div>

<script>
    const students = {
        "A": [
            {r: "24E11A04D9", n: "K.bharath", p: "919676245807"},
            {r: "24E11A0402", n: "P.Kumar", p: "919177937305"}
        ],
        "B": []
    };

    let att = {};

    function loadList() {
        const sec = document.getElementById('sec-sel').value;
        const container = document.getElementById('list');
        container.innerHTML = '';
        att = {};
        students[sec].forEach(s => {
            att[s.r] = 'P';
            const div = document.createElement('div');
            div.className = 'student-item is-p';
            div.id = `card-${s.r}`;
            
            div.innerHTML = `
                <div onclick="toggleAtt('${s.r}')" style="flex-grow:1;">
                    <strong class="d-block">${s.r}</strong>
                    <small class="text-muted">${s.n}</small>
                </div>
                <div class="d-flex gap-2">
                    <a href="tel:${s.p}" class="btn-action bg-primary text-white">ðŸ“ž</a>
                    <a href="https://wa.me/${s.p}?text=${encodeURIComponent(document.getElementById('custom-msg').value)}" class="btn-action bg-success text-white">ðŸ’¬</a>
                </div>
            `;
            container.appendChild(div);
        });
        updateStats();
    }

    function toggleAtt(roll) {
        const mode = document.querySelector('input[name="m"]:checked').value;
        att[roll] = mode;
        const card = document.getElementById(`card-${roll}`);
        card.className = 'student-item ' + (mode === 'P' ? 'is-p' : 'is-a');
        updateStats();
    }

    function updateStats() {
        const sec = document.getElementById('sec-sel').value;
        const total = students[sec].length;
        if(total === 0) return;
        const present = Object.values(att).filter(v => v === 'P').length;
        document.getElementById('perc-ui').innerText = Math.round((present/total)*100) + '%';
    }

    function generateReport() {
        const sec = document.getElementById('sec-sel').value;
        const absentees = students[sec].filter(s => att[s.r] === 'A');
        const total = students[sec].length;
        const presentCount = total - absentees.length;
        const date = new Date().toLocaleDateString();

        return `ðŸ“Š *ATTENDANCE REPORT*
ðŸ“Œ *Section:* ${sec}
ðŸ“… *Date:* ${date}
âœ… *Present:* ${presentCount}
âŒ *Absent:* ${absentees.length}
ðŸ“ˆ *Percentage:* ${document.getElementById('perc-ui').innerText}

ðŸš« *ABSENT ROLL NUMBERS:*
${absentees.length > 0 ? absentees.map(s => `â€¢ ${s.r} (${s.n})`).join('\n') : "None! All present."}

_Generated by ECE Attendance System_`;
    }

    function shareGroupReport() {
        const report = generateReport();
        const waUrl = `https://wa.me/?text=${encodeURIComponent(report)}`;
        window.open(waUrl, '_blank');
    }

    function copyToClipboard() {
        const report = generateReport();
        navigator.clipboard.writeText(report);
        alert("Report copied to clipboard!");
    }

    function sendVoiceSMS() {
        const sec = document.getElementById('sec-sel').value;
        const abs = students[sec].filter(s => att[s.r] === 'A');
        const msg = document.getElementById('custom-msg').value;
        if (abs.length === 0) return alert("No absentees!");
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const numbers = abs.map(s => s.p).join(isIOS ? ',' : ';');
        window.location.href = `sms:${numbers}?body=${encodeURIComponent(msg)}`;
    }

    document.getElementById('date-time').innerText = new Date().toDateString();
    loadList();
</script>
</body>
</html>
